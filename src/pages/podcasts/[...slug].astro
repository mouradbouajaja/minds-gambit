---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, render } from 'astro:content';

export async function getStaticPaths() {
  const episodes = await getCollection('podcasts');
  return episodes.map(ep => ({
    params: { slug: ep.id },
    props: { ep },
  }));
}

const { ep } = Astro.props;
const { Content } = await render(ep);
---

<BaseLayout title={ep.data.title + " â€” The Mind's Gambit"}>
  <nav id="navbar">
    <div class="nav-inner">
      <a href="/" class="nav-logo">M.<span>B</span></a>
      <ul class="nav-links">
        <li><a href="/">Home</a></li>
        <li><a href="/blog">Blog</a></li>
        <li><a href="/podcasts">Podcasts</a></li>
      </ul>
    </div>
  </nav>

  <main class="episode">
    <article>
      <header class="episode-header">
        <a href="/podcasts" class="back-link">&larr; Back to Podcasts</a>
        <time datetime={ep.data.date}>
          {new Date(ep.data.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
        </time>
        <h1>{ep.data.title}</h1>
        {ep.data.description && <p class="episode-desc">{ep.data.description}</p>}
      </header>

      <div class="video-container">
        <iframe
          src={`https://www.youtube.com/embed/${ep.data.youtubeId}`}
          title={ep.data.title}
          frameborder="0"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
          allowfullscreen
        ></iframe>
      </div>

      <div class="episode-content">
        <Content />
      </div>

      <footer class="episode-footer">
        <a href="/podcasts" class="back-link">&larr; All Episodes</a>
        {ep.data.youtubeUrl && <a href={ep.data.youtubeUrl} target="_blank" rel="noopener noreferrer" class="yt-link">Watch on YouTube &rarr;</a>}
      </footer>
    </article>
  </main>

  <style>
    .episode { max-width: 800px; margin: 0 auto; padding: 120px 20px 60px; }
    .back-link { color: #c9a84c; text-decoration: none; font-size: 0.9rem; transition: opacity 0.3s; }
    .back-link:hover { opacity: 0.7; }
    .episode-header { margin-bottom: 2rem; }
    .episode-header time { display: block; font-size: 0.8rem; color: #c9a84c; text-transform: uppercase; letter-spacing: 1px; margin: 1rem 0 0.3rem; }
    .episode-header h1 { font-family: 'Playfair Display', Georgia, serif; font-size: 2.5rem; color: #f0e6d2; line-height: 1.2; margin: 0; }
    .episode-desc { color: #aaa; font-size: 1.1rem; margin-top: 0.5rem; line-height: 1.6; }
    .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 12px; border: 1px solid rgba(201,168,76,0.2); margin-bottom: 2rem; }
    .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
    .episode-content { color: #ccc; line-height: 1.8; font-size: 1.05rem; }
    .episode-content :global(h2) { font-family: "Playfair Display", Georgia, serif; color: #c9a84c; font-size: 1.5rem; margin-top: 2rem; }
    .episode-content :global(p) { margin-bottom: 1rem; }
    .episode-content :global(a) { color: #c9a84c; text-decoration: underline; }
    .episode-footer { margin-top: 3rem; padding-top: 2rem; border-top: 1px solid rgba(201,168,76,0.15); display: flex; justify-content: space-between; align-items: center; }
    .yt-link { color: #c9a84c; text-decoration: none; font-size: 0.9rem; }
    .yt-link:hover { text-decoration: underline; }
    @media (max-width: 600px) { .episode-header h1 { font-size: 1.8rem; } }
  </style>
</BaseLayout>
